<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MNIST Digit Recognition</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: #f9f9f9;
        text-align: center;
        margin: 40px;
      }

      h1 {
        color: #333;
      }

      #canvas {
        border: 2px solid #ddd;
        background-color: #000;
        cursor: crosshair;
      }

      #buttons {
        margin: 15px;
      }

      button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        background-color: #007bff;
        color: white;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
      }

      #resultBox {
        margin-top: 25px;
        padding: 10px;
        background-color: #d4edda;
        color: #155724;
        font-weight: bold;
        border-radius: 5px;
        display: inline-block;
      }

      #probabilityChart {
        max-width: 500px;
        margin: 30px auto;
      }

      .subtitle {
        color: #666;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <h1>MNIST Digit Recognition</h1>
    <div class="subtitle">Deep Learning with PyTorch & Flask</div>

    <canvas id="canvas" width="280" height="280"></canvas>

    <div id="buttons">
      <button onclick="clearCanvas()">Clear</button>
      <button onclick="predict()">Predict</button>
    </div>

    <div id="resultBox">Prediction: -- | Confidence: --%</div>

    <canvas id="probabilityChart" width="400" height="200"></canvas>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      let drawing = false;

      canvas.addEventListener("mousedown", () => (drawing = true));
      canvas.addEventListener("mouseup", () => (drawing = false));
      canvas.addEventListener("mouseleave", () => (drawing = false));
      canvas.addEventListener("mousemove", draw);

      function draw(e) {
        if (!drawing) return;
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(e.offsetX, e.offsetY, 10, 0, Math.PI * 2);
        ctx.fill();
      }

      function clearCanvas() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        document.getElementById("resultBox").innerText =
          "Prediction: -- | Confidence: --%";
        if (window.probChart) window.probChart.destroy();
      }

      function predict() {
        const imageData = canvas.toDataURL("image/png");
        fetch("/predict", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ image: imageData }),
        })
          .then((res) => res.json())
          .then((data) => {
            const maxProb = Math.max(...data.probabilities);
            const confidence = (maxProb * 100).toFixed(1);

            document.getElementById(
              "resultBox"
            ).innerText = `Predicted Digit: ${data.prediction} | Confidence: ${confidence}%`;

            const ctxBar = document
              .getElementById("probabilityChart")
              .getContext("2d");

            if (window.probChart) window.probChart.destroy();

            window.probChart = new Chart(ctxBar, {
              type: "bar",
              data: {
                labels: [...Array(10).keys()],
                datasets: [
                  {
                    label: "Probability",
                    data: data.probabilities,
                    backgroundColor: "rgba(75, 192, 192, 0.6)",
                    borderColor: "rgba(75, 192, 192, 1)",
                    borderWidth: 1,
                  },
                ],
              },
              options: {
                scales: {
                  y: {
                    beginAtZero: true,
                    max: 1,
                  },
                },
              },
            });
          });
      }

      window.onload = () => {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      };
    </script>
  </body>
</html>
